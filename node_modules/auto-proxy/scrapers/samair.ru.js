"use strict";

module.exports = function () {
    const request = require('request');
    const cheerio = require('cheerio');

    const baseUri = 'http://www.samair.ru/proxy';
    let proxies = [];

    for (let page = 1; page <= 30; page++) {
        let _page = page < 10 ? `0${page}` : page; //Add a 0 in front. \o/

        let req = wait.for(request.get, `${baseUri}/proxy-${_page}.htm`);
        let $ = cheerio.load(req.body);

        let __req = wait.for(request.get, `${baseUri.replace('/proxy', '')}${$('#ipportonly').find('a').attr('href')}`);
        let __$ = cheerio.load(__req.body);
        let rawProxyList = __$('#content > pre').text().split('\n');
        for (let z in rawProxyList) {
            if (rawProxyList[z] !== "") {
                proxies.push(rawProxyList[z]);
            }
        }
    }

    return proxies;
};