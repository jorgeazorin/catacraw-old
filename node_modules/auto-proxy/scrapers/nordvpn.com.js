"use strict";
module.exports = function (logger) {
    logger('Scraping nordvpn.com ...');

    const request = require('request');
    const Q = require('q');

    let proxies = [];

    let defer = Q.defer();

    // Share da cookiez!
    let cookies = request.jar();

    // Get Session
    request.get('https://nordvpn.com/free-proxy-list/', {
        jar: cookies
    }, function (err) {
        if (err === null || typeof err === typeof undefined) {
            // Get proxies from API
            request.post('https://nordvpn.com/wp-admin/admin-ajax.php?searchParameters%5B0%5D%5Bname%5D=proxy-country&searchParameters%5B0%5D%5Bvalue%5D=&searchParameters%5B1%5D%5Bname%5D=proxy-ports&searchParameters%5B1%5D%5Bvalue%5D=&offset=0&limit=1000&action=getProxies', {
                jar: cookies
            }, function (err, res) {
                let result = JSON.parse(res.body);

                for (let key in result) {
                    proxies.push(`${result[key]["ip"]}:${result[key]["port"]}`);
                }

                defer.resolve(proxies);
            });
        }
    });

    return defer.promise;
};
